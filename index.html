<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fish & Chips Delivery Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.25.6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    .fade-down {
      animation: fadeDown 0.5s ease-out forwards;
    }
    @keyframes fadeDown {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(20px); }
    }
    .slide-up {
      animation: slideUp 0.5s ease-out forwards;
    }
    @keyframes slideUp {
      from { transform: translateY(0); }
      to { transform: translateY(-100%); }
    }
    .fade-out {
      animation: fadeOut 0.3s ease-out forwards;
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .scale-transition {
      transition: transform 0.2s ease;
    }
    .scale-transition:hover {
      transform: scale(1.05);
    }
    .dark {
      background: linear-gradient(135deg, #1a202c, #2d3748);
    }
    .light {
      background: #a8a8a8;
    }
    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .content {
      flex: 1 0 auto;
      overflow-y: auto;
    }
    .delivery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.75rem;
    }
    .delivery-grid > div {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      cursor: pointer;
    }
    .dark .delivery-grid > div {
      background-color: #2d3748;
    }
    .light .delivery-grid > div {
      background-color: #e5e7eb;
    }
    .dark .delivery-grid > div:hover {
      background-color: #4a5568;
    }
    .light .delivery-grid > div:hover {
      background-color: #d1d5db;
    }
    .delivery-grid span {
      font-size: clamp(0.75rem, 3vw, 0.875rem);
      margin-top: 0.5rem;
    }
    .dark .delivery-grid span {
      color: #ffffff;
    }
    .light .delivery-grid span {
      color: #111827;
    }
    .delivery-grid button {
      margin-top: 0.5rem;
      font-size: clamp(0.75rem, 3vw, 0.875rem);
    }
    .delivery-list > div {
      transition: transform 0.5s ease-out;
      cursor: pointer;
    }
    .toast {
      position: fixed;
      bottom: 10rem;
      left: 50%;
      transform: translateX(-50%);
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      z-index: 50;
      max-width: 90vw;
    }
    .dark .toast {
      background-color: #2d3748;
      color: #ffffff;
    }
    .light .toast {
      background-color: #e5e7eb;
      color: #111827;
    }
    .changelog-container {
      flex-shrink: 0;
      width: 100%;
      max-width: 90vw;
      margin: 0 auto;
      padding: 1rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .changelog-list {
      padding-left: 1.5rem;
    }
    .changelog-list > li {
      margin-bottom: 0.5rem;
    }
    .changelog-list .added {
      color: #10b981;
      list-style-type: "‚ûï ";
    }
    .changelog-close {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 60;
    }
    .delivery-display {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .keypad-button {
      padding: 1rem;
      font-size: clamp(1rem, 4vw, 1.25rem);
      border-radius: 0.5rem;
      text-align: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    .dark .keypad-button {
      background-color: #4a5568;
      color: #ffffff;
    }
    .light .keypad-button {
      background-color: #d1d5db;
      color: #111827;
    }
    .dark .keypad-button:hover {
      background-color: #718096;
    }
    .light .keypad-button:hover {
      background-color: #a0aec0;
    }
    .error-boundary {
      padding: 1rem;
      text-align: center;
      color: #ff0000;
    }
  </style>
</head>
<body class="dark">
  <div id="root"></div>
  <script type="text/babel">/* === APP: Fish & Chips Delivery Tracker (cleaned) === */

/* === CHANGE BREAKDOWN HELPERS === */
const denominations = [
  { name: "¬£20 note", value: 2000 },
  { name: "¬£10 note", value: 1000 },
  { name: "¬£5 note", value: 500 },
  { name: "¬£2 coin", value: 200 },
  { name: "¬£1 coin", value: 100 },
  { name: "50p coin", value: 50 },
  { name: "20p coin", value: 20 },
  { name: "10p coin", value: 10 },
  { name: "5p coin", value: 5 },
  { name: "2p coin", value: 2 },
  { name: "1p coin", value: 1 },
];

const getChangeBreakdownObject = (amount) => {
  let remaining = Math.round((parseFloat(amount) || 0) * 100);
  const result = {};
  for (const d of denominations) {
    const count = Math.floor(remaining / d.value);
    if (count > 0) {
      result[d.name] = count;
      remaining -= count * d.value;
    }
  }
  return result;
};

const combineBreakdowns = (deliveries) => {
  const totals = {};
  deliveries
    .filter((d) => d.paymentStatus === "not-paid")
    .forEach((d) => {
      const breakdown = getChangeBreakdownObject(d.changeDue);
      for (const [name, count] of Object.entries(breakdown)) {
        totals[name] = (totals[name] || 0) + count;
      }
    });
  return totals;
};



    // Error Boundary Component
    class ErrorBoundary extends React.Component {
      state = { hasError: false, error: null };

      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }

      componentDidCatch(error, errorInfo) {
        console.error('ErrorBoundary caught an error:', error, errorInfo);
      }

      render() {
        if (this.state.hasError) {
          return (
            <div className="error-boundary">
              <h2>Something went wrong.</h2>
              <p>{this.state.error?.message || 'Please try refreshing the page.'}</p>
            </div>
          );
        }
        return this.props.children;
      }
    }

    const NumberKeypad = ({ value, onChange }) => {
      const handleKeyPress = (key) => {
        if (key === 'backspace') {
          onChange(value.slice(0, -1));
        } else if (key === '.' && !value.includes('.')) {
          onChange(value + key);
        } else if (/[0-9]/.test(key)) {
          onChange(value + key);
        }
      };

      const keys = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '.', '0', 'backspace'];

      return (
        <div className="keypad">
          {keys.map((key, index) => (
            <div
              key={index}
              className="keypad-button"
              onClick={() => handleKeyPress(key)}
            >
              {key === 'backspace' ? '‚Üê' : key}
            </div>
          ))}
        </div>
      );
    };

    const App = () => {
      const [deliveryList, setDeliveryList] = React.useState(() => {
        try {
          const saved = localStorage.getItem('deliveryList');
          return saved ? JSON.parse(saved) : [];
        } catch (e) {
          console.error('Error loading deliveryList from localStorage:', e);
          return [];
        }
      });
      const [historyList, setHistoryList] = React.useState(() => {
        try {
          const saved = localStorage.getItem('historyList');
          return saved ? JSON.parse(saved) : [];
        } catch (e) {
          console.error('Error loading historyList from localStorage:', e);
          return [];
        }
      });
      const [showDeliveryPopup, setShowDeliveryPopup] = React.useState(false);
      const [showPaymentPopup, setShowPaymentPopup] = React.useState(false);
      const [showHistoryPopup, setShowHistoryPopup] = React.useState(false);
      const [showChangeConfirmationPopup, setShowChangeConfirmationPopup] = React.useState(false);
      const [showQuickCalculatorPopup, setShowQuickCalculatorPopup] = React.useState(false);
      const [showHistoryEditPopup, setShowHistoryEditPopup] = React.useState(null);
      const [showHistoryDeleteConfirm, setShowHistoryDeleteConfirm] = React.useState(null);
      const [postcode, setPostcode] = React.useState('');
      const [amountDue, setAmountDue] = React.useState('');
      const [details, setDetails] = React.useState('');
      const [customerPaidAmount, setCustomerPaidAmount] = React.useState('');
      const [quickCalcAmount, setQuickCalcAmount] = React.useState('');
      const [paymentStatus, setPaymentStatus] = React.useState('paid');
      const [showResetConfirm, setShowResetConfirm] = React.useState(false);
      const [showDeleteConfirm, setShowDeleteConfirm] = React.useState(null);

  // Change summary popup state
  const [showChangeSummary, setShowChangeSummary] = React.useState(false);
      const [showEditPopup, setShowEditPopup] = React.useState(null);
      const [showDeliveryInfo, setShowDeliveryInfo] = React.useState(null);
      const [showChangelogPopup, setShowChangelogPopup] = React.useState(false);
      const [fadingItemIndex, setFadingItemIndex] = React.useState(null);
      const [slidingItems, setSlidingItems] = React.useState([]);
      const [isClosingDeliveryPopup, setIsClosingDeliveryPopup] = React.useState(false);
      const [isClosingPaymentPopup, setIsClosingPaymentPopup] = React.useState(false);
      const [isClosingResetPopup, setIsClosingResetPopup] = React.useState(false);
      const [isClosingDeletePopup, setIsClosingDeletePopup] = React.useState(false);
      const [isClosingEditPopup, setIsClosingEditPopup] = React.useState(false);
      const [isClosingDeliveryInfo, setIsClosingDeliveryInfo] = React.useState(false);
      const [isClosingChangelogPopup, setIsClosingChangelogPopup] = React.useState(false);
      const [isClosingHistoryPopup, setIsClosingHistoryPopup] = React.useState(false);
      const [isClosingChangeConfirmationPopup, setIsClosingChangeConfirmationPopup] = React.useState(false);
      const [isClosingQuickCalculatorPopup, setIsClosingQuickCalculatorPopup] = React.useState(false);
      const [isClosingHistoryEditPopup, setIsClosingHistoryEditPopup] = React.useState(false);
      const [isClosingHistoryDeletePopup, setIsClosingHistoryDeletePopup] = React.useState(false);
      const [isGridView, setIsGridView] = React.useState(false);
      const [isDarkMode, setIsDarkMode] = React.useState(() => {
        try {
          const saved = localStorage.getItem('isDarkMode');
          return saved !== null ? JSON.parse(saved) : true;
        } catch (e) {
          console.error('Error loading isDarkMode from localStorage:', e);
          return true;
        }
      });
      const [showToast, setShowToast] = React.useState(false);
      const [lastAction, setLastAction] = React.useState(null);
      const [searchQuery, setSearchQuery] = React.useState('');

      React.useEffect(() => {
        try {
          localStorage.setItem('deliveryList', JSON.stringify(deliveryList));
        } catch (e) {
          console.error('Error saving deliveryList to localStorage:', e);
        }
      }, [deliveryList]);

      React.useEffect(() => {
        try {
          localStorage.setItem('historyList', JSON.stringify(historyList));
        } catch (e) {
          console.error('Error saving historyList to localStorage:', e);
        }
      }, [historyList]);

      React.useEffect(() => {
        try {
          localStorage.setItem('isDarkMode', JSON.stringify(isDarkMode));
          document.body.className = isDarkMode ? 'dark' : 'light';
        } catch (e) {
          console.error('Error saving isDarkMode to localStorage:', e);
        }
      }, [isDarkMode]);

      React.useEffect(() => {
        if (showToast) {
          const timer = setTimeout(() => {
            setShowToast(false);
            setLastAction(null);
          }, 5000);
          return () => clearTimeout(timer);
        }
      }, [showToast]);

      const formatPostcode = (input) => {
        if (!input) return '';
        const cleaned = input.replace(/\s/g, '').toUpperCase();
        const regex = /^([A-Z]{1,2}\d{1,2}[A-Z]?)?(\d[A-Z]{2})?$/;
        const match = cleaned.match(regex);
        if (match && match[1] && match[2]) {
          return `${match[1]} ${match[2]}`;
        }
        return cleaned;
      };

      const getOrdinalSuffix = (day) => {
        if (day > 3 && day < 21) return 'th';
        switch (day % 10) {
          case 1: return 'st';
          case 2: return 'nd';
          case 3: return 'rd';
          default: return 'th';
        }
      };

      const formatTimestamp = (timestamp) => {
        try {
          const date = new Date(timestamp);
          if (isNaN(date.getTime())) throw new Error('Invalid timestamp');
          const day = date.getDate();
          const month = date.getMonth() + 1;
          const hours = date.getHours();
          const minutes = date.getMinutes();
          const ampm = hours >= 12 ? 'pm' : 'am';
          const hours12 = hours % 12 || 12;
          const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
          
          const formattedDay = `${dayNames[date.getDay()]} ${day}${getOrdinalSuffix(day)} ${monthNames[month - 1]}`;
          const formattedTime = `${hours12}:${minutes.toString().padStart(2, '0')}${ampm}`;
          
          return {
            date: formattedDay,
            day: formattedDay,
            time: formattedTime
          };
        } catch (e) {
          console.error('Error formatting timestamp:', e);
          return { date: '', day: '', time: '' };
        }
      };

      const calculateChange = (due) => {
        const amount = parseFloat(due) || 0;
        if (amount <= 0) return 0;
        const threshold = Math.ceil(amount / 20) * 20;
        return (threshold - amount).toFixed(2);
      };

      const calculateCustomerChange = (amountDue, paid) => {
        const due = parseFloat(amountDue) || 0;
        const paidAmount = parseFloat(paid) || 0;
        return paidAmount >= due ? (paidAmount - due).toFixed(2) : 0;
      };

      const handlePostcodeChange = (e) => {
        setPostcode(formatPostcode(e.target.value));
      };

      const addDelivery = () => {
        if (!postcode.trim()) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Postcode cannot be empty.' });
          return;
        }
        if (paymentStatus === 'not-paid' && (!amountDue || parseFloat(amountDue) <= 0)) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Amount due must be greater than ¬£0.' });
          return;
        }
        const delivery = {
          postcode,
          paymentStatus,
          amountDue: paymentStatus === 'not-paid' ? parseFloat(amountDue) || 0 : 0,
          changeDue: paymentStatus === 'not-paid' ? calculateChange(amountDue) : 0,
          details: details.trim(),
          timestamp: new Date().toISOString(),
        };
        setDeliveryList([delivery, ...deliveryList]);
        setLastAction({ type: 'add', data: delivery });
        setShowToast(true);
        setIsClosingPaymentPopup(true);
        setTimeout(() => {
          setShowDeliveryPopup(false);
          setShowPaymentPopup(false);
          setIsClosingPaymentPopup(false);
          setPostcode('');
          setAmountDue('');
          setDetails('');
          setPaymentStatus('paid');
        }, 300);
      };

      const addPaidDelivery = () => {
        if (!postcode.trim()) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Postcode cannot be empty.' });
          return;
        }
        const delivery = {
          postcode,
          paymentStatus: 'paid',
          amountDue: 0,
          changeDue: 0,
          details: details.trim(),
          timestamp: new Date().toISOString(),
        };
        setDeliveryList([delivery, ...deliveryList]);
        setLastAction({ type: 'add', data: delivery });
        setShowToast(true);
        setIsClosingDeliveryPopup(true);
        setTimeout(() => {
          setShowDeliveryPopup(false);
          setIsClosingDeliveryPopup(false);
          setPostcode('');
          setDetails('');
          setPaymentStatus('paid');
        }, 300);
      };

      const editDelivery = (index) => {
        if (!postcode.trim()) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Postcode cannot be empty.' });
          return;
        }
        if (paymentStatus === 'not-paid' && (!amountDue || parseFloat(amountDue) <= 0)) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Amount due must be greater than ¬£0.' });
          return;
        }
        const updatedDelivery = {
          postcode,
          paymentStatus,
          amountDue: paymentStatus === 'not-paid' ? parseFloat(amountDue) || 0 : 0,
          changeDue: paymentStatus === 'not-paid' ? calculateChange(amountDue) : 0,
          details: details.trim(),
          timestamp: deliveryList[index].timestamp,
        };
        const updatedList = [...deliveryList];
        updatedList[index] = updatedDelivery;
        setDeliveryList(updatedList);
        setLastAction({ type: 'edit', data: { ...updatedDelivery, index } });
        setShowToast(true);
        setIsClosingEditPopup(true);
        setTimeout(() => {
          setShowEditPopup(null);
          setIsClosingEditPopup(false);
          setPostcode('');
          setAmountDue('');
          setDetails('');
          setPaymentStatus('paid');
        }, 300);
      };

      const editHistoryDelivery = (index) => {
        if (!postcode.trim()) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Postcode cannot be empty.' });
          return;
        }
        if (paymentStatus === 'not-paid' && (!amountDue || parseFloat(amountDue) <= 0)) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Amount due must be greater than ¬£0.' });
          return;
        }
        const updatedDelivery = {
          postcode,
          paymentStatus,
          amountDue: paymentStatus === 'not-paid' ? parseFloat(amountDue) || 0 : 0,
          changeDue: paymentStatus === 'not-paid' ? calculateChange(amountDue) : 0,
          details: details.trim(),
          timestamp: historyList[index].timestamp,
        };
        const updatedList = [...historyList];
        updatedList[index] = updatedDelivery;
        setHistoryList(updatedList);
        setLastAction({ type: 'editHistory', data: { ...updatedDelivery, index } });
        setShowToast(true);
        setIsClosingHistoryEditPopup(true);
        setTimeout(() => {
          setShowHistoryEditPopup(null);
          setIsClosingHistoryEditPopup(false);
          setPostcode('');
          setAmountDue('');
          setDetails('');
          setPaymentStatus('paid');
        }, 300);
      };

      const deleteDelivery = (index) => {
        const item = deliveryList[index];
        const updatedList = deliveryList.filter((_, i) => i !== index);
        setDeliveryList(updatedList);
        setLastAction({ type: 'delete', data: { ...item, index } });
        setShowToast(true);
        setIsClosingDeletePopup(true);
        setTimeout(() => {
          setShowDeleteConfirm(null);
          setIsClosingDeletePopup(false);
        }, 300);
      };

      const deleteHistoryDelivery = (index) => {
        const item = historyList[index];
        const updatedList = historyList.filter((_, i) => i !== index);
        setHistoryList(updatedList);
        setLastAction({ type: 'deleteHistory', data: { ...item, index } });
        setShowToast(true);
        setIsClosingHistoryDeletePopup(true);
        setTimeout(() => {
          setShowHistoryDeleteConfirm(null);
          setIsClosingHistoryDeletePopup(false);
        }, 300);
      };

      const markDelivered = (index) => {
        if (!deliveryList[index]) {
          console.error('Invalid delivery index:', index);
          return;
        }
        const delivery = deliveryList[index];
        if (delivery.paymentStatus === 'not-paid') {
          setShowChangeConfirmationPopup(true);
        } else {
          setFadingItemIndex(index);
          const item = deliveryList[index];
          setHistoryList([item, ...historyList]);
          setLastAction({ type: 'deliver', data: { ...item, index } });
          setShowToast(true);
          const itemsToSlide = isGridView ? [] : deliveryList.filter((_, i) => i > index).map((_, i) => index + i + 1);
          setSlidingItems(itemsToSlide);
          setTimeout(() => {
            const updatedList = deliveryList.filter((_, i) => i !== index);
            setDeliveryList(updatedList);
            setFadingItemIndex(null);
            setSlidingItems([]);
          }, 500);
          setIsClosingDeliveryInfo(true);
          setTimeout(() => {
            setShowDeliveryInfo(null);
            setIsClosingDeliveryInfo(false);
          }, 300);
        }
      };

      const confirmDelivery = (index) => {
        if (!deliveryList[index]) {
          console.error('Invalid delivery index:', index);
          return;
        }
        const delivery = deliveryList[index];
        const paidAmount = parseFloat(customerPaidAmount) || 0;
        if (paidAmount < delivery.amountDue) {
          setShowToast(true);
          setLastAction({ type: 'error', data: 'Customer payment must be at least the amount due.' });
          return;
        }
        setFadingItemIndex(index);
        const item = deliveryList[index];
        setHistoryList([item, ...historyList]);
        setLastAction({ type: 'deliver', data: { ...item, index } });
        setShowToast(true);
        const itemsToSlide = isGridView ? [] : deliveryList.filter((_, i) => i > index).map((_, i) => index + i + 1);
        setSlidingItems(itemsToSlide);
        setTimeout(() => {
          const updatedList = deliveryList.filter((_, i) => i !== index);
          setDeliveryList(updatedList);
          setFadingItemIndex(null);
          setSlidingItems([]);
        }, 500);
        setIsClosingChangeConfirmationPopup(true);
        setTimeout(() => {
          setShowChangeConfirmationPopup(false);
          setIsClosingChangeConfirmationPopup(false);
          setCustomerPaidAmount('');
          setShowDeliveryInfo(null);
          setIsClosingDeliveryInfo(false);
        }, 300);
      };

      const keepTheChange = (index) => {
        if (!deliveryList[index]) {
          console.error('Invalid delivery index:', index);
          return;
        }
        setFadingItemIndex(index);
        const item = deliveryList[index];
        setHistoryList([item, ...historyList]);
        setLastAction({ type: 'deliver', data: { ...item, index } });
        setShowToast(true);
        const itemsToSlide = isGridView ? [] : deliveryList.filter((_, i) => i > index).map((_, i) => index + i + 1);
        setSlidingItems(itemsToSlide);
        setTimeout(() => {
          const updatedList = deliveryList.filter((_, i) => i !== index);
          setDeliveryList(updatedList);
          setFadingItemIndex(null);
          setSlidingItems([]);
        }, 500);
        setIsClosingChangeConfirmationPopup(true);
        setTimeout(() => {
          setShowChangeConfirmationPopup(false);
          setIsClosingChangeConfirmationPopup(false);
          setCustomerPaidAmount('');
          setShowDeliveryInfo(null);
          setIsClosingDeliveryInfo(false);
        }, 300);
      };

      const resetDay = () => {
        setLastAction({ type: 'reset', data: { deliveryList: [...deliveryList], historyList: [...historyList] } });
        setShowToast(true);
        setDeliveryList([]);
        setHistoryList([]);
        setIsClosingResetPopup(true);
        setTimeout(() => {
          setShowResetConfirm(false);
          setIsClosingResetPopup(false);
        }, 300);
      };

      const undoAction = () => {
        if (!lastAction) return;
        if (lastAction.type === 'add') {
          setDeliveryList(deliveryList.slice(1));
        } else if (lastAction.type === 'deliver') {
          const { data } = lastAction;
          const updatedList = [...deliveryList];
          updatedList.splice(data.index, 0, data);
          setDeliveryList(updatedList);
          setHistoryList(historyList.slice(1));
        } else if (lastAction.type === 'delete') {
          const { data } = lastAction;
          const updatedList = [...deliveryList];
          updatedList.splice(data.index, 0, data);
          setDeliveryList(updatedList);
        } else if (lastAction.type === 'deleteHistory') {
          const { data } = lastAction;
          const updatedList = [...historyList];
          updatedList.splice(data.index, 0, data);
          setHistoryList(updatedList);
        } else if (lastAction.type === 'edit') {
          const { data } = lastAction;
          const updatedList = [...deliveryList];
          updatedList[data.index] = data;
          setDeliveryList(updatedList);
        } else if (lastAction.type === 'editHistory') {
          const { data } = lastAction;
          const updatedList = [...historyList];
          updatedList[data.index] = data;
          setHistoryList(updatedList);
        } else if (lastAction.type === 'reset') {
          setDeliveryList(lastAction.data.deliveryList);
          setHistoryList(lastAction.data.historyList);
        }
        setShowToast(false);
        setLastAction(null);
      };

      const toggleView = () => {
        setIsGridView(!isGridView);
      };

      const toggleTheme = () => {
        setIsDarkMode(!isDarkMode);
      };

      const toggleChangelogPopup = () => {
        if (showChangelogPopup) {
          setIsClosingChangelogPopup(true);
          setTimeout(() => {
            setShowChangelogPopup(false);
            setIsClosingChangelogPopup(false);
          }, 300);
        } else {
          setShowChangelogPopup(true);
        }
      };

      const toggleHistoryPopup = () => {
        if (showHistoryPopup) {
          setIsClosingHistoryPopup(true);
          setTimeout(() => {
            setShowHistoryPopup(false);
            setIsClosingHistoryPopup(false);
          }, 300);
        } else {
          setShowHistoryPopup(true);
        }
      };

      const openEditPopup = (index) => {
        const delivery = deliveryList[index];
        setPostcode(delivery.postcode);
        setPaymentStatus(delivery.paymentStatus);
        setAmountDue(delivery.amountDue.toString());
        setDetails(delivery.details || '');
        setShowEditPopup(index);
      };

      const openHistoryEditPopup = (index) => {
        const delivery = historyList[index];
        setPostcode(delivery.postcode);
        setPaymentStatus(delivery.paymentStatus);
        setAmountDue(delivery.amountDue.toString());
        setDetails(delivery.details || '');
        setShowHistoryEditPopup(index);
      };

      const filteredDeliveryList = deliveryList.filter(delivery => 
        delivery.postcode.toLowerCase().includes(searchQuery.toLowerCase()) ||
        (delivery.paymentStatus === 'not-paid' && delivery.amountDue.toString().includes(searchQuery))
      );

      return (
        <ErrorBoundary>
          <div className="app-container">
            <header className="w-full max-w-[90vw] mx-auto mb-6">
              <div className="flex items-center justify-between mb-4">
                <h1 className={`text-[clamp(1.5rem,5vw,2rem)] font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                  Fish & Chips Delivery Tracker
                </h1>
                <div className="flex space-x-2">
                  <button
                    onClick={toggleView}
                    className="w-10 h-10 rounded-full bg-blue-700 text-white flex items-center justify-center text-lg font-semibold hover:bg-blue-600 scale-transition"
                    aria-label="Toggle view"
                  >
                    <i className={`fas ${isGridView ? 'fa-bars' : 'fa-th'}`}></i>
                  </button>
				  
                  <button
                    onClick={toggleTheme}
                    className="w-10 h-10 rounded-full bg-blue-700 text-white flex items-center justify-center text-lg font-semibold hover:bg-blue-600 scale-transition"
                    aria-label="Toggle theme"
                  >
                    <i className={`fas ${isDarkMode ? 'fa-moon' : 'fa-sun'}`}></i>
                  </button>
				  
                </div>
              </div>
              <div className="flex space-x-2">
                <button
                  onClick={() => setShowDeliveryPopup(true)}
                  className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-green-600 ${isDarkMode ? 'bg-green-700' : 'bg-green-600'}`}
                >
                  Add Delivery
                </button>
                <button
                  onClick={toggleHistoryPopup}
                  className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-blue-600 ${isDarkMode ? 'bg-blue-700' : 'bg-blue-600'}`}
                  aria-label="View delivery history"
                >
                  Delivery History
                </button>
				
                <button
                  onClick={() => setShowQuickCalculatorPopup(true)}
                  className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-yellow-600 ${isDarkMode ? 'bg-yellow-700' : 'bg-yellow-600'}`}
                  aria-label="Quick Change Calculator"
                >
                  Change Calc
                </button>
				
              </div>
            </header>

            <main className="content">
              <div className="w-full max-w-[90vw] mx-auto">
                <div className="flex justify-between items-center mb-4">
  <h2
    className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold ${
      isDarkMode ? 'text-white' : 'text-gray-900'
    }`}
  >
    Today's Deliveries
  </h2>
  <div className="flex space-x-2">
    {/* ü™ô Total Change Button */}
    <button
      onClick={() => setShowChangeSummary(true)}
      className="px-4 py-2 bg-purple-700 text-white rounded-lg shadow-md hover:bg-purple-600 text-[clamp(0.875rem,3vw,1rem)]"
    >
      Total Change
    </button>

    {/* üîÅ Reset Day Button */}
    <button
      onClick={() => setShowResetConfirm(true)}
      className="px-4 py-2 bg-red-700 text-white rounded-lg shadow-md hover:bg-red-600 text-[clamp(0.875rem,3vw,1rem)]"
    >
      Reset Day
    </button>
  </div>
</div>


                <p className={`text-[clamp(1rem,4vw,1.125rem)] font-semibold mb-4 ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                  Total Deliveries: {deliveryList.length}
                </p>
                <div className="relative mb-4">
                  <input
                    type="text"
                    placeholder="Search by postcode or amount..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className={`w-full p-2 border rounded-lg ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Search deliveries"
                  />
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      className="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                    >
                      <i className="fas fa-times"></i>
                    </button>
                  )}
                </div>
                {filteredDeliveryList.length === 0 ? (
                  <p className={`text-center ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>No deliveries found.</p>
                ) : (
                  <div className={isGridView ? 'delivery-grid' : 'space-y-3'}>
                    {filteredDeliveryList.map((delivery, index) => (
                      <div
                        key={index}
                        className={`flex ${isGridView ? '' : 'items-center justify-between p-3 rounded-lg shadow-md'} ${
                          fadingItemIndex === index ? 'fade-down' : isGridView ? '' : slidingItems.includes(index) ? 'slide-up' : ''
                        } ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                        onClick={() => setShowDeliveryInfo(index)}
                      >
                        <div className={isGridView ? 'delivery-display' : 'flex items-center delivery-display'}>
                          <span className={isGridView ? '' : `text-[clamp(1rem,4vw,1.125rem)] ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                            {delivery.postcode} | {delivery.paymentStatus === 'paid' ? 'Paid' : `¬£${delivery.amountDue.toFixed(2)}`}
                          </span>
                        </div>
                        {!isGridView && (
                          <div className="flex space-x-2" onClick={(e) => e.stopPropagation()}>
                            <button
                              onClick={() => openEditPopup(index)}
                              className="text-blue-500 hover:text-blue-700"
                              aria-label="Edit delivery"
                            >
                              <i className="fas fa-edit"></i>
                            </button>
                            <button
                              onClick={() => setShowDeleteConfirm(index)}
                              className="text-red-500 hover:text-red-700"
                              aria-label="Delete delivery"
                            >
                              <i className="fas fa-trash"></i>
                            </button>
                          </div>
                        )}
                        {isGridView && (
                          <div className="flex space-x-2 mt-2" onClick={(e) => e.stopPropagation()}>
                            <button
                              onClick={() => openEditPopup(index)}
                              className="px-3 py-1.5 bg-yellow-700 text-white rounded-lg shadow-md hover:bg-yellow-600 text-[clamp(0.75rem,3vw,0.875rem)]"
                            >
                              <i className="fas fa-edit"></i>
                            </button>
                            <button
                              onClick={() => setShowDeleteConfirm(index)}
                              className="px-3 py-1.5 bg-red-700 text-white rounded-lg shadow-md hover:bg-red-600 text-[clamp(0.75rem,3vw,0.875rem)]"
                            >
                              <i className="fas fa-trash"></i>
                            </button>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </main>

            <div className="changelog-container">
              <button
                onClick={toggleChangelogPopup}
                className={`underline mb-4 ${isDarkMode ? 'text-gray-200 hover:text-blue-500' : 'text-gray-600 hover:text-blue-500'}`}
              >
                Changelog
              </button>
              <span className={isDarkMode ? 'text-gray-200' : 'text-gray-600'}>V5.1</span>
            </div>

            {/* === POPUP: Add Delivery === */}


            {showDeliveryPopup && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingDeliveryPopup(true);
                  setTimeout(() => {
                    setShowDeliveryPopup(false);
                    setIsClosingDeliveryPopup(false);
                    setPostcode('');
                    setDetails('');
                    setPaymentStatus('paid');
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h2 className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                    Add New Delivery
                  </h2>
                  <input
                    type="text"
                    placeholder="Enter postcode (e.g., S714RF)"
                    value={postcode}
                    onChange={handlePostcodeChange}
                    className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Postcode"
                  />
                  <textarea
                    placeholder="Additional details (optional)"
                    value={details}
                    onChange={(e) => setDetails(e.target.value)}
                    className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Additional details"
                    rows="3"
                  />
                  <div className="flex justify-between mb-4">
                    <button
                      onClick={addPaidDelivery}
                      className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-green-600 ${paymentStatus === 'paid' ? (isDarkMode ? 'bg-green-700' : 'bg-green-600') : (isDarkMode ? 'bg-gray-700' : 'bg-gray-400')}`}
                    >
                      Paid
                    </button>
                    <button
                      onClick={() => {
                        setPaymentStatus('not-paid');
                        setShowPaymentPopup(true);
                      }}
                      className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-red-600 ${paymentStatus === 'not-paid' ? (isDarkMode ? 'bg-red-700' : 'bg-red-600') : (isDarkMode ? 'bg-gray-700' : 'bg-gray-400')}`}
                    >
                      Not Paid
                    </button>
                  </div>
                  <div className="flex justify-end">
                    <button
                      onClick={() => {
                        setIsClosingDeliveryPopup(true);
                        setTimeout(() => {
                          setShowDeliveryPopup(false);
                          setIsClosingDeliveryPopup(false);
                          setPostcode('');
                          setDetails('');
                          setPaymentStatus('paid');
                        }, 300);
                      }}
                      className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === POPUP: Enter Amount Due === */}


            {showPaymentPopup && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingPaymentPopup(true);
                  setTimeout(() => {
                    setShowPaymentPopup(false);
                    setIsClosingPaymentPopup(false);
                    setAmountDue('');
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h2 className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                    Enter Amount Due
                  </h2>
                  <input
                    type="text"
                    readOnly
                    value={amountDue}
                    placeholder=" Amount due (¬£)"
                    className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Amount due"
                  />
                  <NumberKeypad value={amountDue} onChange={setAmountDue} />
                  <div className="flex justify-end space-x-2 mt-4">
                    <button
                      onClick={() => {
                        setIsClosingPaymentPopup(true);
                        setTimeout(() => {
                          setShowPaymentPopup(false);
                          setIsClosingPaymentPopup(false);
                          setAmountDue('');
                        }, 300);
                      }}
                      className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={addDelivery}
                      className="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Confirm
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === POPUP: Edit Delivery === */}


            {showEditPopup !== null && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingEditPopup(true);
                  setTimeout(() => {
                    setShowEditPopup(null);
                    setIsClosingEditPopup(false);
                    setPostcode('');
                    setAmountDue('');
                    setDetails('');
                    setPaymentStatus('paid');
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h2 className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                    Edit Delivery
                  </h2>
                  <input
                    type="text"
                    placeholder="Enter postcode (e.g., S714RF)"
                    value={postcode}
                    onChange={handlePostcodeChange}
                    className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Postcode"
                  />
                  <textarea
                    placeholder="Additional details (optional)"
                    value={details}
                    onChange={(e) => setDetails(e.target.value)}
                    className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Additional details"
                    rows="3"
                  />
                  <div className="flex justify-between mb-4">
                    <button
                      onClick={() => {
                        setPaymentStatus('paid');
                      }}
                      className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-green-600 ${paymentStatus === 'paid' ? (isDarkMode ? 'bg-green-700' : 'bg-green-600') : (isDarkMode ? 'bg-gray-700' : 'bg-gray-400')}`}
                    >
                      Paid
                    </button>
                    <button
                      onClick={() => setPaymentStatus('not-paid')}
                      className={`flex-1 py-2 rounded-lg font-semibold text-white shadow-md hover:bg-red-600 ${paymentStatus === 'not-paid' ? (isDarkMode ? 'bg-red-700' : 'bg-red-600') : (isDarkMode ? 'bg-gray-700' : 'bg-gray-400')}`}
                    >
                      Not Paid
                    </button>
                  </div>
                  {paymentStatus === 'not-paid' && (
                    <>
                      <input
                        type="text"
                        readOnly
                        value={amountDue}
                        placeholder="Amount due (¬£)"
                        className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                        aria-label="Amount due"
                      />
                      <NumberKeypad value={amountDue} onChange={setAmountDue} />
                    </>
                  )}
                  <div className="flex justify-end space-x-2 mt-4">
                    <button
                      onClick={() => {
                        setIsClosingEditPopup(true);
                        setTimeout(() => {
                          setShowEditPopup(null);
                          setIsClosingEditPopup(false);
                          setPostcode('');
                          setAmountDue('');
                          setDetails('');
                          setPaymentStatus('paid');
                        }, 300);
                      }}
                      className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={() => editDelivery(showEditPopup)}
                      className="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Save
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === POPUP: Edit History Entry === */}


            {showHistoryEditPopup !== null && (
  <div
    className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
    onClick={() => {
      setIsClosingHistoryEditPopup(true);
      setTimeout(() => {
        setShowHistoryEditPopup(null);
        setIsClosingHistoryEditPopup(false);
        setPostcode('');
        setAmountDue('');
        setDetails('');
        setPaymentStatus('paid');
      }, 300);
    }}
  >
    <div
      className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800 text-white' : 'bg-gray-200 text-gray-900'}`}
      onClick={(e) => e.stopPropagation()}
    >
      <h2 className="text-xl font-bold mb-4 text-center">Edit History Entry</h2>

      <div className="space-y-4">
        <div>
          <label className="block mb-1 text-sm font-medium">Postcode</label>
          <input
            type="text"
            value={postcode}
            onChange={handlePostcodeChange}
            className={`w-full p-2 border rounded-lg ${isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-100 border-gray-300 text-gray-900'}`}
            placeholder="e.g. S714RF"
          />
        </div>

        <div>
          <label className="block mb-1 text-sm font-medium">Details</label>
          <textarea
            value={details}
            onChange={(e) => setDetails(e.target.value)}
            rows="3"
            className={`w-full p-2 border rounded-lg ${isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-100 border-gray-300 text-gray-900'}`}
            placeholder="Additional notes..."
          />
        </div>

        <div>
          <label className="block mb-2 text-sm font-medium">Payment Status</label>
          <div className="flex space-x-2">
            <button
              onClick={() => {
                setPaymentStatus('paid');
              }}
              className={`flex-1 py-2 rounded-lg font-semibold shadow-md ${
                paymentStatus === 'paid'
                  ? isDarkMode
                    ? 'bg-green-700 text-white'
                    : 'bg-green-600 text-white'
                  : isDarkMode
                    ? 'bg-gray-700 text-gray-300'
                    : 'bg-gray-300 text-gray-700'
              }`}
            >
              Paid
            </button>
            <button
              onClick={() => setPaymentStatus('not-paid')}
              className={`flex-1 py-2 rounded-lg font-semibold shadow-md ${
                paymentStatus === 'not-paid'
                  ? isDarkMode
                    ? 'bg-red-700 text-white'
                    : 'bg-red-600 text-white'
                  : isDarkMode
                    ? 'bg-gray-700 text-gray-300'
                    : 'bg-gray-300 text-gray-700'
              }`}
            >
              Not Paid
            </button>
          </div>
        </div>

        {paymentStatus === 'not-paid' && (
          <div>
            <label className="block mb-1 text-sm font-medium">Amount Due (¬£)</label>
            <input
              type="text"
              readOnly
              value={amountDue}
              className={`w-full p-2 border rounded-lg mb-2 ${
                isDarkMode
                  ? 'bg-gray-700 border-gray-600 text-white'
                  : 'bg-gray-100 border-gray-300 text-gray-900'
              }`}
            />
            <NumberKeypad value={amountDue} onChange={setAmountDue} />
          </div>
        )}
      </div>

      <div className="flex justify-end space-x-2 mt-6">
        <button
          onClick={() => {
            setIsClosingHistoryEditPopup(true);
            setTimeout(() => {
              setShowHistoryEditPopup(null);
              setIsClosingHistoryEditPopup(false);
              setPostcode('');
              setAmountDue('');
              setDetails('');
              setPaymentStatus('paid');
            }, 300);
          }}
          className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md"
        >
          Cancel
        </button>
        <button
          onClick={() => editHistoryDelivery(showHistoryEditPopup)}
          className="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-600 shadow-md"
        >
          Save
        </button>
      </div>
    </div>
  </div>
)}


            {/* === CONFIRM: Reset Day === */}



            {showResetConfirm && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingResetPopup(true);
                  setTimeout(() => {
                    setShowResetConfirm(false);
                    setIsClosingResetPopup(false);
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <p className={`mb-4 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                    Are you sure you want to reset today's delivery list and history?
                  </p>
                  <div className="flex justify-end space-x-2">
                    <button
                      onClick={() => {
                        setIsClosingResetPopup(true);
                        setTimeout(() => {
                          setShowResetConfirm(false);
                          setIsClosingResetPopup(false);
                        }, 300);
                      }}
                      className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={resetDay}
                      className="px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Reset
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === CONFIRM: Delete Delivery === */}


            {showDeleteConfirm !== null && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingDeletePopup(true);
                  setTimeout(() => {
                    setShowDeleteConfirm(null);
                    setIsClosingDeletePopup(false);
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <p className={`mb-4 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                    Are you sure you want to delete this delivery?
                  </p>
                  <div className="flex justify-end space-x-2">
                    <button
                      onClick={() => {
                        setIsClosingDeletePopup(true);
                        setTimeout(() => {
                          setShowDeleteConfirm(null);
                          setIsClosingDeletePopup(false);
                        }, 300);
                      }}
                      className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={() => deleteDelivery(showDeleteConfirm)}
                      className="px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === CONFIRM: Delete History Entry === */}


            {showHistoryDeleteConfirm !== null && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingHistoryDeletePopup(true);
                  setTimeout(() => {
                    setShowHistoryDeleteConfirm(null);
                    setIsClosingHistoryDeletePopup(false);
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <p className={`mb-4 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                    Are you sure you want to delete this history entry?
                  </p>
                  <div className="flex justify-end space-x-2">
                    <button
                      onClick={() => {
                        setIsClosingHistoryDeletePopup(true);
                        setTimeout(() => {
                          setShowHistoryDeleteConfirm(null);
                          setIsClosingHistoryDeletePopup(false);
                        }, 300);
                      }}
                      className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={() => deleteHistoryDelivery(showHistoryDeleteConfirm)}
                      className="px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === POPUP: Delivery Details === */}


            {showDeliveryInfo !== null && deliveryList[showDeliveryInfo] && (
  <div
    className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
    onClick={() => {
      setIsClosingDeliveryInfo(true);
      setTimeout(() => {
        setShowDeliveryInfo(null);
        setIsClosingDeliveryInfo(false);
      }, 300);
    }}
  >
    <div
      className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
      onClick={(e) => e.stopPropagation()}
    >
      <h2 className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
        Delivery Details
      </h2>
      <p className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
        {deliveryList[showDeliveryInfo].postcode} | {deliveryList[showDeliveryInfo].paymentStatus === 'paid' ? 'Paid' : `¬£${deliveryList[showDeliveryInfo].amountDue.toFixed(2)}`}
      </p>
      {deliveryList[showDeliveryInfo].paymentStatus === 'not-paid' && (
      <>
        <p
          className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${
            isDarkMode ? 'text-gray-200' : 'text-gray-600'
          }`}
        >
          <strong>Change:</strong> ¬£{deliveryList[showDeliveryInfo].changeDue}
        </p>

        {/* Per-delivery change breakdown */}
        <div
          className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${
            isDarkMode ? 'text-gray-200' : 'text-gray-600'
          }`}
        >
          <strong>Breakdown:</strong>
          <ul className="list-disc list-inside">
            {Object.entries(
              getChangeBreakdownObject(deliveryList[showDeliveryInfo].changeDue)
            ).map(([name, count]) => (
              <li key={name}>
                {count} √ó {name}
              </li>
            ))}
          </ul>
        </div>
      </>
    )}
      {deliveryList[showDeliveryInfo].details && (
  <p
    className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${
      isDarkMode ? 'text-gray-200' : 'text-gray-600'
    }`}
    dangerouslySetInnerHTML={{
      __html: `<strong>Details:</strong><br />${deliveryList[
        showDeliveryInfo
      ].details.replace(/\\n|\n/g, '<br />')}`,
    }}
  />
)}

      <p className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
        <strong>Date:</strong> {formatTimestamp(deliveryList[showDeliveryInfo].timestamp).date}
      </p>
      <p className={`mb-4 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
        <strong>Time:</strong> {formatTimestamp(deliveryList[showDeliveryInfo].timestamp).time}
      </p>

      <div className="flex justify-between mt-4">
        <button
          onClick={() => {
            // Close details and open edit popup for this delivery
            setIsClosingDeliveryInfo(true);
            setTimeout(() => {
              const current = showDeliveryInfo;
              setShowDeliveryInfo(null);
              setIsClosingDeliveryInfo(false);
              openEditPopup(current);
            }, 300);
          }}
          className="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
        >
          Edit
        </button>

        <div className="flex space-x-2">
          <button
            onClick={() => {
              setIsClosingDeliveryInfo(true);
              setTimeout(() => {
                setShowDeliveryInfo(null);
                setIsClosingDeliveryInfo(false);
              }, 300);
            }}
            className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
          >
            Close
          </button>
          <button
            onClick={() => markDelivered(showDeliveryInfo)}
            className="px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
          >
            Mark Delivered
          </button>
        </div>
      </div>
    </div>
  </div>
)}


            {/* === POPUP: Confirm Payment === */}



            {showChangeConfirmationPopup && showDeliveryInfo !== null && deliveryList[showDeliveryInfo] && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
                onClick={() => {
                  setIsClosingChangeConfirmationPopup(true);
                  setTimeout(() => {
                    setShowChangeConfirmationPopup(false);
                    setIsClosingChangeConfirmationPopup(false);
                    setCustomerPaidAmount('');
                  }, 300);
                }}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h2 className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                    Confirm Payment
                  </h2>
                  <p className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                    Amount Due: ¬£{deliveryList[showDeliveryInfo].amountDue.toFixed(2)}
                  </p>
                  <input
                    type="text"
                    readOnly
                    value={customerPaidAmount}
                    placeholder="Customer paid (¬£)"
                    className={`w-full p-2 border rounded-lg mb-4 ${isDarkMode ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600' : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'}`}
                    aria-label="Customer paid amount"
                  />
                  <p className={`mb-4 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                    Change to Give: ¬£{calculateCustomerChange(deliveryList[showDeliveryInfo].amountDue, customerPaidAmount)}
          {/* Coin / Note Breakdown */}
          {parseFloat(customerPaidAmount) > 0 &&
            calculateCustomerChange(deliveryList[showDeliveryInfo].amountDue, customerPaidAmount) > 0 && (
              <div
                className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}
              >
                <strong>Breakdown:</strong>
                <ul className="list-disc list-inside">
                  {Object.entries(
                    getChangeBreakdownObject(
                      calculateCustomerChange(
                        deliveryList[showDeliveryInfo].amountDue,
                        customerPaidAmount
                      )
                    )
                  ).map(([name, count]) => (
                    <li key={name}>
                      {count} √ó {name}
                    </li>
                  ))}
                </ul>
              </div>
            )}
                  </p>
                  <NumberKeypad value={customerPaidAmount} onChange={setCustomerPaidAmount} />
                  <div className="flex justify-between space-x-2 mt-4">
                    <button
                      onClick={() => keepTheChange(showDeliveryInfo)}
                      className="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-500 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Keep the Change
                    </button>
                    <div className="flex space-x-2">
                      <button
                        onClick={() => {
                          setIsClosingChangeConfirmationPopup(true);
                          setTimeout(() => {
                            setShowChangeConfirmationPopup(false);
                            setIsClosingChangeConfirmationPopup(false);
                            setCustomerPaidAmount('');
                          }, 300);
                        }}
                        className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                      >
                        Cancel
                      </button>
                      <button
                        onClick={() => confirmDelivery(showDeliveryInfo)}
                        className="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                      >
                        Confirm
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* === POPUP: Quick Change Calculator === */}
			{/* === POPUP: Total Change Summary === */}
{showChangeSummary && (
  <div
    className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]"
    onClick={() => {
      setIsClosingChangeConfirmationPopup(true);
      setTimeout(() => {
        setShowChangeSummary(false);
        setIsClosingChangeConfirmationPopup(false);
      }, 300);
    }}
  >
    <div
      className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] overflow-y-auto max-h-[80vh] ${
        isDarkMode ? 'bg-gray-800 text-white' : 'bg-gray-200 text-gray-900'
      }`}
      onClick={(e) => e.stopPropagation()}
    >
      <h2 className="text-xl font-bold mb-4 text-center">Total Change Needed</h2>

      {Object.keys(combineBreakdowns(deliveryList)).length === 0 ? (
        <p className="text-center text-gray-400">No unpaid deliveries found.</p>
      ) : (
        <>
          {/* üí∞ Total Value */}
          <p className="text-center font-semibold mb-3">
            Total Value: ¬£
            {(
              Object.entries(combineBreakdowns(deliveryList)).reduce(
                (sum, [name, count]) =>
                  sum +
                  count *
                    (denominations.find((d) => d.name === name)?.value || 0),
                0
              ) / 100
            ).toFixed(2)}
          </p>

          {/* ü™ô Denomination Breakdown */}
          <ul className="list-disc list-inside space-y-1 text-sm">
  {Object.entries(combineBreakdowns(deliveryList))
    .sort(
      ([aName], [bName]) =>
        (denominations.find((d) => d.name === bName)?.value || 0) -
        (denominations.find((d) => d.name === aName)?.value || 0)
    )
    .map(([name, count]) => (
      <li key={name}>
        {count} √ó {name}
      </li>
    ))}
</ul>

        </>
      )}

      <div className="flex justify-end mt-6">
        <button
          onClick={() => {
            setIsClosingChangeConfirmationPopup(true);
            setTimeout(() => {
              setShowChangeSummary(false);
              setIsClosingChangeConfirmationPopup(false);
            }, 300);
          }}
          className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md"
        >
          Close
        </button>
      </div>
    </div>
  </div>
)}




            {showQuickCalculatorPopup && (
  <div
    className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]"
    onClick={() => {
      setIsClosingQuickCalculatorPopup(true);
      setTimeout(() => {
        setShowQuickCalculatorPopup(false);
        setIsClosingQuickCalculatorPopup(false);
        setQuickCalcAmount('');
      }, 300);
    }}
  >
    <div
      className={`flex flex-col justify-between p-6 rounded-lg w-[90vw] max-w-md h-[80vh] shadow-lg ${
        isDarkMode ? 'bg-gray-800' : 'bg-gray-200'
      }`}
      onClick={(e) => e.stopPropagation()}
    >
      {/* === Scrollable Top Section === */}
      <div
        className="flex-1 overflow-y-auto mb-4 transition-all duration-300"
        style={{ scrollBehavior: 'smooth' }}
      >
        <h2
          className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${
            isDarkMode ? 'text-white' : 'text-gray-900'
          }`}
        >
          Quick Change Calculator
        </h2>

        <input
          type="text"
          readOnly
          value={quickCalcAmount}
          placeholder="Enter amount due (¬£)"
          className={`w-full p-2 border rounded-lg mb-4 ${
            isDarkMode
              ? 'bg-gray-700 text-white placeholder-gray-400 border-gray-600'
              : 'bg-gray-200 text-gray-900 placeholder-gray-500 border-gray-300'
          }`}
          aria-label="Amount due for calculation"
        />

        {/* üí∑ CALCULATED CHANGE */}
        <p
          className={`text-[clamp(0.875rem,3vw,1rem)] mb-2 ${
            isDarkMode ? 'text-gray-200' : 'text-gray-600'
          }`}
        >
          Change Needed: ¬£{calculateChange(quickCalcAmount)}
        </p>

        {/* ü™ô BREAKDOWN SECTION */}
        {parseFloat(quickCalcAmount) > 0 && calculateChange(quickCalcAmount) > 0 && (
          <div
            className={`text-[clamp(0.875rem,3vw,1rem)] ${
              isDarkMode ? 'text-gray-200' : 'text-gray-600'
            }`}
          >
            <strong>Breakdown:</strong>
            <ul className="list-disc list-inside">
              {Object.entries(
                getChangeBreakdownObject(calculateChange(quickCalcAmount))
              ).map(([name, count]) => (
                <li key={name}>
                  {count} √ó {name}
                </li>
              ))}
            </ul>
          </div>
        )}
      </div>

      {/* === Fixed Bottom Section (Keypad + Button) === */}
      <div className="flex-shrink-0">
        <NumberKeypad value={quickCalcAmount} onChange={setQuickCalcAmount} />
        <div className="flex justify-end mt-4">
          <button
            onClick={() => {
              setIsClosingQuickCalculatorPopup(true);
              setTimeout(() => {
                setShowQuickCalculatorPopup(false);
                setIsClosingQuickCalculatorPopup(false);
                setQuickCalcAmount('');
              }, 300);
            }}
            className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
)}



            {/* === PANEL: Delivery History === */}


            {showHistoryPopup && (
              <div
                className={`fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center ${isClosingHistoryPopup ? 'fade-out' : 'fade-in'}`}
                onClick={toggleHistoryPopup}
              >
                <div
                  className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${isDarkMode ? 'bg-gray-800 text-gray-200' : 'bg-gray-200 text-gray-900'}`}
                  onClick={(e) => e.stopPropagation()}
                  style={{ maxHeight: '70vh', overflowY: 'auto' }}
                >
                  <h3 className={`text-[clamp(1.25rem,4vw,1.5rem)] font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                    Delivery History
                  </h3>
                  {historyList.length === 0 ? (
                    <p className={`text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                      No deliveries in history.
                    </p>
                  ) : (
                    <div className="space-y-3">
                      {historyList.map((delivery, index) => (
                        <div
                          key={index}
                          className={`p-3 rounded-lg ${isDarkMode ? 'bg-gray-700' : 'bg-gray-300'}`}
                        >
                          <div className="flex justify-between items-center">
                            <div className="delivery-display">
                              <p className={`text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                                {delivery.postcode} | {delivery.paymentStatus === 'paid' ? 'Paid' : `¬£${delivery.amountDue.toFixed(2)}`}
                              </p>
                            </div>
                            <div className="flex space-x-2">
                              <button
                                onClick={() => openHistoryEditPopup(index)}
                                className="text-blue-500 hover:text-blue-700"
                                aria-label="Edit history delivery"
                              >
                                <i className="fas fa-edit"></i>
                              </button>
                              <button
                                onClick={() => setShowHistoryDeleteConfirm(index)}
                                className="text-red-500 hover:text-red-700"
                                aria-label="Delete history delivery"
                              >
                                <i className="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                          {delivery.paymentStatus === 'not-paid' && (
                            <p className={`text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                              Change: ¬£{delivery.changeDue}
                            </p>
                          )}
                          {delivery.details && (
  <p
    className={`text-[clamp(0.875rem,3vw,1rem)] ${
      isDarkMode ? 'text-gray-200' : 'text-gray-600'
    }`}
    dangerouslySetInnerHTML={{
      __html: `<strong>Details:</strong><br />${delivery.details.replace(/\\n|\n/g, '<br />')}`,
    }}
  />
)}

                          <p className={`text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                            <strong>Date:</strong> {formatTimestamp(delivery.timestamp).date}
                          </p>
                          <p className={`text-[clamp(0.875rem,3vw,1rem)] ${isDarkMode ? 'text-gray-200' : 'text-gray-600'}`}>
                            <strong>Time:</strong> {formatTimestamp(delivery.timestamp).time}
                          </p>
                        </div>
                      ))}
                    </div>
                  )}
                  <div className="flex justify-end mt-4">
                    <button
                      onClick={toggleHistoryPopup}
                      className="px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-600 shadow-md text-[clamp(0.875rem,3vw,1rem)]"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* === PANEL: Changelog === */}


            {showChangelogPopup && (
  <div
    className={`fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]`}
    onClick={() => {
      setIsClosingChangelogPopup(true);
      setTimeout(() => {
        setShowChangelogPopup(false);
        setIsClosingChangelogPopup(false);
      }, 300);
    }}
  >
    <div
      className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] overflow-y-auto max-h-[80vh] ${
        isDarkMode ? 'bg-gray-800 text-white' : 'bg-gray-200 text-gray-900'
      }`}
      onClick={(e) => e.stopPropagation()}
    >
      <h2 className="text-xl font-bold mb-4 text-center">Changelog</h2>

      <div className="space-y-6 text-sm">

        {/* === V5.1 === */}
        <div>
          <h3 className="font-bold">V5.1</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-gray-400">‚öôÔ∏è Fixed popup overlap issue on mobile.</li>
            <li className="text-gray-400">‚öôÔ∏è Better button alignment and spacing.</li>
            <li className="text-gray-400">‚öôÔ∏è Minor performance and animation improvements.</li>
          </ul>
        </div>

        {/* === V5.0 === */}
        <div>
          <h3 className="font-bold">V5.0</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© Added a new ‚ÄúTotal Change‚Äù button next to Reset Day.</li>
            <li className="text-green-500">üü© Instantly see all coins and notes needed across unpaid deliveries.</li>
            <li className="text-green-500">üü© Shows total cash value of all change combined.</li>
            <li className="text-green-500">üü© Sorted neatly from highest to lowest denomination (¬£20 ‚Üí 1p).</li>
            <li className="text-gray-400">‚öôÔ∏è Polished dark mode visuals and popup animations.</li>
            <li className="text-gray-400">‚öôÔ∏è Fixed layout quirks for smoother use on all screens.</li>
          </ul>
        </div>

        {/* === V4.1 === */}
        <div>
          <h3 className="font-bold">V4.1</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-gray-400">‚öôÔ∏è Calculator now remembers your last entry.</li>
            <li className="text-gray-400">‚öôÔ∏è Fixed rounding issues with small coins.</li>
            <li className="text-gray-400">‚öôÔ∏è Popups open and close more smoothly.</li>
          </ul>
        </div>

        {/* === V4.0 === */}
        <div>
          <h3 className="font-bold">V4.0</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© Added the Quick Change Calculator.</li>
            <li className="text-green-500">üü© Instantly calculate change with full coin and note breakdowns.</li>
            <li className="text-gray-400">‚öôÔ∏è Redesigned popups for a cleaner look.</li>
            <li className="text-gray-400">‚öôÔ∏è Adjusted button sizes for better mobile usability.</li>
          </ul>
        </div>

        {/* === V3.1 === */}
        <div>
          <h3 className="font-bold">V3.1</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-gray-400">‚öôÔ∏è Editing popups open faster and smoother.</li>
            <li className="text-gray-400">‚öôÔ∏è Fixed issue where deleted deliveries could reappear.</li>
            <li className="text-gray-400">‚öôÔ∏è Improved confirmation messages and transitions.</li>
          </ul>
        </div>

        {/* === V3.0 === */}
        <div>
          <h3 className="font-bold">V3.0</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© Added Edit Delivery and Delete Delivery popups.</li>
            <li className="text-green-500">üü© Introduced History View for completed deliveries.</li>
            <li className="text-green-500">üü© Deliveries now auto-save between sessions.</li>
            <li className="text-gray-400">‚öôÔ∏è Improved Reset Day to clear everything properly.</li>
          </ul>
        </div>

        {/* === V2.1 === */}
        <div>
          <h3 className="font-bold">V2.1</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-gray-400">‚öôÔ∏è Fixed dark mode color contrast.</li>
            <li className="text-gray-400">‚öôÔ∏è Smoothed out popup animations.</li>
            <li className="text-gray-400">‚öôÔ∏è Adjusted text size and spacing for better visibility.</li>
          </ul>
        </div>

        {/* === V2.0 === */}
        <div>
          <h3 className="font-bold">V2.0</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© Added Dark Mode / Light Mode toggle.</li>
            <li className="text-gray-400">‚öôÔ∏è Updated button styles and transitions.</li>
            <li className="text-gray-400">‚öôÔ∏è Improved readability and layout on all devices.</li>
          </ul>
        </div>

        {/* === V1.3 === */}
        <div>
          <h3 className="font-bold">V1.3</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© Added Reset Day button for daily cleanups.</li>
            <li className="text-gray-400">‚öôÔ∏è Added confirmation step to prevent accidental resets.</li>
            <li className="text-gray-400">‚öôÔ∏è Improved colors and smoother text.</li>
          </ul>
        </div>

        {/* === V1.2 === */}
        <div>
          <h3 className="font-bold">V1.2</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© Deliveries now auto-save after refresh.</li>
            <li className="text-green-500">üü© Added ‚ÄúNo Deliveries Yet‚Äù message.</li>
            <li className="text-gray-400">‚öôÔ∏è Improved loading and flow.</li>
          </ul>
        </div>

        {/* === V1.1 === */}
        <div>
          <h3 className="font-bold">V1.1</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-gray-400">‚öôÔ∏è Tidied up buttons and spacing.</li>
            <li className="text-gray-400">‚öôÔ∏è Cleaned up delivery list layout.</li>
            <li className="text-gray-400">‚öôÔ∏è Fixed small display issues.</li>
          </ul>
        </div>

        {/* === V1.0 === */}
        <div>
          <h3 className="font-bold">V1.0</h3>
          <ul className="list-none mt-2 space-y-1">
            <li className="text-green-500">üü© The Fish & Chips Delivery Tracker is born!</li>
            <li className="text-green-500">üü© Add deliveries with names, totals, and payment status.</li>
            <li className="text-green-500">üü© Track how much you‚Äôve made for the day.</li>
            <li className="text-gray-400">‚öôÔ∏è Simple, fast layout made for busy chip shop runs.</li>
          </ul>
        </div>
      </div>

      <div className="flex justify-end mt-6">
        <button
          onClick={() => {
            setIsClosingChangelogPopup(true);
            setTimeout(() => {
              setShowChangelogPopup(false);
              setIsClosingChangelogPopup(false);
            }, 300);
          }}
          className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md"
        >
          Close
        </button>
      </div>
    </div>
  </div>
)}



            {showToast && (
              <div className={`toast flex items-center space-x-4 fade-in`}>
                <p className={`font-semibold text-[clamp(0.875rem,3vw,1rem)]`}>
                  {lastAction?.type === 'add' ? 'Delivery added.' : 
                   lastAction?.type === 'edit' ? 'Delivery edited.' : 
                   lastAction?.type === 'delete' ? 'Delivery deleted.' : 
                   lastAction?.type === 'deliver' ? 'Delivery marked as delivered.' : 
                   lastAction?.type === 'reset' ? 'Delivery list and history reset.' : 
                   lastAction?.type === 'error' ? lastAction.data : ''}
                </p>
                {lastAction?.type !== 'error' && (
                  <button
                    onClick={undoAction}
                    className="px-3 py-1 bg-blue-700 text-white rounded-lg hover:bg-blue-600 shadow-md text-[clamp(0.75rem,3vw,0.875rem)]"
                  >
                    Undo
                  </button>
                )}
              </div>
            )}
          </div>
        </ErrorBoundary>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  
{/* === POPUP: Total Change Breakdown === */}
{showChangeSummary && (
  <div
    className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]"
    onClick={() => setShowChangeSummary(false)}
  >
    <div
      className={`p-6 rounded-lg w-[90vw] max-w-md shadow-lg overflow-y-auto max-h-[80vh] ${
        isDarkMode ? 'bg-gray-800' : 'bg-gray-200'
      }`}
      onClick={(e) => e.stopPropagation()}
    >
      <h2
        className={`text-[clamp(1.25rem,4vw,1.5rem)] font-semibold mb-4 ${
          isDarkMode ? 'text-white' : 'text-gray-900'
        }`}
      >
        Total Change Breakdown
      </h2>

      {(() => {
        const totals = combineBreakdowns(deliveryList);
        const totalAmount = deliveryList
          .filter((d) => d.paymentStatus === 'not-paid')
          .reduce((acc, d) => acc + d.changeDue, 0);

        return (
          <>
            <p
              className={`mb-2 text-[clamp(0.875rem,3vw,1rem)] ${
                isDarkMode ? 'text-gray-200' : 'text-gray-600'
              }`}
            >
              <strong>Total Change Needed:</strong> ¬£{totalAmount.toFixed(2)}
            </p>
            <ul className="list-disc list-inside mb-4">
              {Object.entries(totals).map(([name, count]) => (
                <li key={name}>
                  {count} √ó {name}
                </li>
              ))}
            </ul>
          </>
        );
      })()}

      <button
        onClick={() => setShowChangeSummary(false)}
        className="mt-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 shadow-md"
      >
        Close
      </button>
    </div>
  </div>
)}

</script>
</body>
</html>
